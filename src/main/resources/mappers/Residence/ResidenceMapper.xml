<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.springbootfinal.app.mapper.residence.ResidenceMapper">

    <!-- 숙소와 사진 정보를 조인하여 가져오는 쿼리 -->
    <select id="getResidenceWithPhotos" resultMap="residenceWithPhotosResultMap">
        SELECT r.*, p.*
        FROM residence r
                 LEFT JOIN property_photos p ON r.resid_no = p.resid_no
        WHERE r.resid_no = #{residNo}
    </select>

    <!-- 결과를 ResidenceDto와 PropertyPhotosDto에 매핑 -->
    <resultMap id="residenceWithPhotosResultMap" type="com.springbootfinal.app.domain.residence.ResidenceDto">
        <id property="residNo" column="resid_no"/>
        <result property="residName" column="resid_name"/>
        <result property="residDescription" column="resid_description"/>
        <result property="residAddress" column="resid_address"/>
        <result property="residType" column="resid_type"/>
        <result property="checkinDate" column="checkin_date"/>
        <result property="checkoutDate" column="checkout_date"/>
        <result property="totalPrice" column="total_price"/>
        <result property="discountRate" column="discount_rate"/>
        <result property="discountedPrice" column="discounted_price"/>
        <result property="rating" column="rating"/>
        <result property="residDate" column="resid_date"/>
        <!-- 사진 관련 필드 매핑 -->
        <association property="propertyPhotos" javaType="java.util.List">
            <id property="photoNo" column="photo_no"/>
            <result property="photoUrl01" column="photo_url01"/>
            <result property="photoUrl02" column="photo_url02"/>
            <result property="photoUrl03" column="photo_url03"/>
            <result property="photoUrl04" column="photo_url04"/>
            <result property="photoUrl05" column="photo_url05"/>
            <result property="photoUrl06" column="photo_url06"/>
            <result property="photoUrl07" column="photo_url07"/>
            <result property="photoUrl08" column="photo_url08"/>
            <result property="photoUrl09" column="photo_url09"/>
            <result property="photoUrl10" column="photo_url10"/>
        </association>
    </resultMap>


    <!-- 숙소 등록 -->
    <insert id="insertResidence" parameterType="com.springbootfinal.app.domain.residence.ResidenceDto">
        INSERT INTO residence (
            resid_name,
            resid_description,
            resid_address,
            resid_type,
            checkin_date,
            checkout_date,
            total_price,
            discount_rate,
            discounted_price,
            rating,
            resid_date
        ) VALUES (
                     #{residName},
                     #{residDescription},
                     #{residAddress},
                     #{residType},
                     #{checkinDate},
                     #{checkoutDate},
                     #{totalPrice},
                     #{discountRate},
                     #{discountedPrice},
                     #{rating},
                     NOW()
                 );
    </insert>

    <!-- 숙소 조회 (숙소 번호로 조회) -->
    <select id="getResidenceById" resultType="com.springbootfinal.app.domain.residence.ResidenceDto">
        SELECT * FROM residence WHERE resid_no = #{residNo};
    </select>

    <!-- 숙소 목록 조회 -->
    <select id="getAllResidences" resultType="com.springbootfinal.app.domain.residence.ResidenceDto">
        SELECT * FROM residence;
    </select>

    <!-- 숙소 정보 업데이트 -->
    <update id="updateResidence" parameterType="com.springbootfinal.app.domain.residence.ResidenceDto">
        UPDATE residence
        SET
            resid_name = #{residName},
            resid_description = #{residDescription},
            resid_address = #{residAddress},
            resid_type = #{residType},
            checkin_date = #{checkinDate},
            checkout_date = #{checkoutDate},
            total_price = #{totalPrice},
            discount_rate = #{discountRate},
            discounted_price = #{discountedPrice},
            rating = #{rating}
        WHERE resid_no = #{residNo};
    </update>

    <!-- 숙소 삭제 -->
    <delete id="deleteResidence" parameterType="Long">
        DELETE FROM residence WHERE resid_no = #{residNo};
    </delete>

</mapper>
