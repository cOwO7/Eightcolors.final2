<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/layouts/main_layout}">
<head>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <meta charset="UTF-8">
  <title>숙소 사장님 페이지</title>
  <style>
    .table img {
      max-width: 100px;
      height: auto;
    }
  </style>
</head>
<body>
<th:block layout:fragment="content">
  <div class="container">
    <h1 class="my-4 text-center">숙소 목록</h1>

    <!-- 검색 폼 -->
    <form action="#" th:action="@{/list}" method="get" class="row mb-3">
      <div class="col-md-3">
        <input type="text" name="keyword" class="form-control" placeholder="검색어를 입력하세요" />
      </div>
      <div class="col-md-3">
        <select name="type" class="form-control">
          <option value="">숙소 유형 선택</option>
          <option value="resort">리조트</option>
          <option value="hotel">호텔</option>
          <option value="pension">펜션</option>
          <option value="motel">모텔</option>
        </select>
      </div>
      <div class="col-md-2">
        <button type="submit" class="btn btn-primary">검색</button>
      </div>
    </form>

    <!-- 숙소 등록 버튼 -->
    <div class="mb-3 text-end">
      <a th:href="@{/new}" class="btn btn-success">숙소 등록</a>
    </div>

    <!-- 숙소 목록 테이블 -->
    <table class="table table-bordered table-hover table-responsive">
      <thead class="table-dark">
      <tr>
        <th>번호</th>
        <th>숙소 사진</th>
        <th>숙소 이름</th>
        <th>숙소 유형</th>
        <th>원가</th>
        <th>할인%</th>
        <th>할인 가격</th>
        <th>체크인</th>
        <th>체크아웃</th>
        <th>등록일</th>
        <th>관리</th>
      </tr>
      </thead>
      <tbody>
      <tr th:each="residence : ${residences}">
        <td th:text="${residence.residNo}"></td>
        <td>
          <th:block th:if="${residence.propertyPhotos != null and not #lists.isEmpty(residence.propertyPhotos)}">
            <img th:src="@{|/files/${residence.propertyPhotos[0]}|}" alt="숙소 사진" class="img-fluid"/>
          </th:block>
          <th:block th:unless="${residence.propertyPhotos != null and not #lists.isEmpty(residence.propertyPhotos)}">
            사진 없음
          </th:block>
        </td>
        <td th:text="${residence.residName}"></td>
        <td th:text="${residence.residType}"></td>
        <td th:text="${residence.totalPrice ?: 'N/A'}"></td>
        <td th:text="${residence.discountRate ?: '0'} + '%'"></td>
        <td th:text="${residence.discountedPrice ?: residence.totalPrice}"></td>
        <td th:text="${residence.checkinDate != null ? #dates.format(residence.checkinDate, 'yyyy-MM-dd') : 'N/A'}"></td>
        <td th:text="${residence.checkoutDate != null ? #dates.format(residence.checkoutDate, 'yyyy-MM-dd') : 'N/A'}"></td>
        <td th:text="${#dates.format(residence.residDate, 'yyyy-MM-dd')}"></td>
        <td>
          <a th:href="@{/detail/{residNo}(residNo=${residence.residNo})}">상세보기</a>

        </td>
        <td>
          <a th:href="@{/edit/{id}(id=${residence.residNo})}" class="btn btn-warning btn-sm">수정</a>
          <!-- 삭제는 POST로 처리되어야 하므로 form으로 변경 -->
          <form th:action="@{/delete/{id}(id=${residence.residNo})}" method="post" style="display:inline-block;">
            <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('정말 삭제하시겠습니까?');">삭제</button>
          </form>
        </td>
      </tr>
      <th:block th:if="${#lists.isEmpty(residences)}">
        <tr>
          <td colspan="11" class="text-center">등록된 숙소가 없습니다.</td>
        </tr>
      </th:block>
      </tbody>
    </table>
  </div>
</th:block>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"></script>
</body>
</html>
